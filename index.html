<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Trading Journal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> DesignFX </h1>
            <div class="account-switcher">
                <button id="realAccountBtn" class="active">
                    <i class="fas fa-money-bill-wave"></i> Real Account
                </button>
                <button id="demoAccountBtn" class="demoAccountBtn">
                    <i class="fas fa-flask"></i> Demo Account
                </button>
            </div>
            <div class="theme-toggle">
                <button id="darkModeToggle" class="btn-toggle">
                    <i class="fas fa-moon"></i>
                    <span>Dark Mode</span>
                </button>
            </div>
        </header>

        <div class="main-content">
            <div class="dashboard-section">
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>Real Account</h3>
                        <div class="stat-value" id="realProfit">R0.00</div>
                        <div class="stat-label">Total Profit/Loss</div>
                    </div>
                    <div class="stats-card">
                        <h3>Demo Account</h3>
                        <div class="stat-value" id="demoProfit">R0.00</div>
                        <div class="stat-label">Total Profit/Loss</div>
                    </div>
                    <div class="stats-card">
                        <h3>Win Rate</h3>
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="stat-label">All Trades</div>
                    </div>
                    <div class="stats-card">
                        <h3>Total Trades</h3>
                        <div class="stat-value" id="totalTrades">0</div>
                        <div class="stat-label">Recorded</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="profitChart"></canvas>
                </div>
            </div>

            <div class="content-wrapper">
                <div class="card trade-form">
                    <button id="formToggle" class="mobile-collapse-toggle">
                        <i class="fas fa-chevron-down"></i>
                        <span>Add New Trade</span>
                    </button>
                    <div id="formCollapse" class="mobile-collapsible">
                        <div class="card-header">
                            <h2>Add New Trade</h2>
                        </div>
                        <form id="tradeForm">
                            <div class="form-group">
                                <label for="accountType">Account Type:</label>
                                <select id="accountType" required>
                                    <option value="real">Real Account</option>
                                    <option value="demo">Demo Account</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tradeDate">Trade Date:</label>
                                    <input type="date" id="tradeDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="tradeTime">Trade Time:</label>
                                    <input type="time" id="tradeTime" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="instrument">Instrument/Asset:</label>
                                <input type="text" id="instrument" placeholder="e.g., EUR/USD, BTC/USD" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="entryPrice">Entry Price:</label>
                                    <input type="number" id="entryPrice" step="0.00001" required>
                                </div>
                                <div class="form-group">
                                    <label for="exitPrice">Exit Price:</label>
                                    <input type="number" id="exitPrice" step="0.00001" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stopLoss">Stop Loss (SL):</label>
                                    <input type="number" id="stopLoss" step="0.00001">
                                </div>
                                <div class="form-group">
                                    <label for="takeProfit">Take Profit (TP):</label>
                                    <input type="number" id="takeProfit" step="0.00001">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="lotSize">Lot Size/Volume:</label>
                                    <input type="number" id="lotSize" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="profitLoss">Profit/Loss (R):</label>
                                    <input type="number" id="profitLoss" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="positionType">Position Type:</label>
                                    <select id="positionType" required>
                                        <option value="buy">Buy/Long</option>
                                        <option value="sell">Sell/Short</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="tradeOutcome">Trade Outcome:</label>
                                    <select id="tradeOutcome" required>
                                        <option value="win">Win (TP Hit)</option>
                                        <option value="loss">Loss (SL Hit)</option>
                                        <option value="breakeven">Breakeven</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="reason">Reason for Trade:</label>
                                <textarea id="reason" rows="3" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="notes">Notes/Lessons Learned:</label>
                                <textarea id="notes" rows="3"></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Trade
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card trade-filters">
                    <div class="card-header">
                        <h2>Trade History</h2>
                        <div id="tradeCount" class="badge">0 trades</div>
                    </div>

                    <div class="filter-controls">
                        <div class="filter-group">
                            <label for="filterAccount">Account:</label>
                            <select id="filterAccount">
                                <option value="all">All Accounts</option>
                                <option value="real">Real Account</option>
                                <option value="demo">Demo Account</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterInstrument">Instrument:</label>
                            <select id="filterInstrument">
                                <option value="all">All Instruments</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterDateFrom">From:</label>
                            <input type="date" id="filterDateFrom">
                        </div>
                        <div class="filter-group">
                            <label for="filterDateTo">To:</label>
                            <input type="date" id="filterDateTo">
                        </div>
                        <button id="applyFilters" class="btn btn-primary">
                            <i class="fas fa-filter"></i> Apply
                        </button>
                        <button id="resetFilters" class="btn btn-secondary">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>

                    <div class="table-container">
                        <table id="tradeTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="datetime">Date/Time</th>
                                    <th class="sortable" data-sort="account">Account</th>
                                    <th class="sortable" data-sort="instrument">Instrument</th>
                                    <th class="sortable" data-sort="position">Position</th>
                                    <th class="sortable" data-sort="entry">Entry</th>
                                    <th class="sortable" data-sort="exit">Exit</th>
                                    <th class="sortable" data-sort="profit">P/L</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tradeTableBody">
                                <!-- Trades will be inserted here -->
                            </tbody>
                        </table>
                        <div id="emptyState" class="empty-state" style="display: none;">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No Trades Found</h3>
                            <p>Add your first trade to get started</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Trade Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Edit Trade</h2>
            <form id="editTradeForm">
                <input type="hidden" id="editTradeId">
                <!-- Form fields will be inserted here by JavaScript -->
            </form>
            <div class="modal-actions">
                <button id="updateTradeBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> Update Trade
                </button>
                <button id="deleteTradeBtn" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Delete Trade
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Confirm Deletion</h2>
            <p>Are you sure you want to delete this trade? This action cannot be undone.</p>
            <div class="modal-actions">
                <button id="confirmDeleteBtn" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button id="cancelDeleteBtn" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>


    <script src="script.js"></script>
    <script>
        // Add to the top of script.js, inside the DOMContentLoaded event listener

        // Dark mode toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

        // Check for saved theme preference or use system preference
        const currentTheme = localStorage.getItem('theme') ||
            (prefersDarkScheme.matches ? 'dark' : 'light');

        // Apply the current theme
        if (currentTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            darkModeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            darkModeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
        }

        // Toggle dark/light mode
        // Update the dark mode toggle event listener in script.js
        darkModeToggle.addEventListener('click', function () {
            const currentTheme = document.documentElement.getAttribute('data-theme');

            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
            }

            // Update chart colors and re-render trades
            updateChartColors();
            renderTrades(); // This will ensure the table updates with new theme
        });

        // Function to update chart colors based on theme
        function updateChartColors() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            const realColor = isDark ? 'rgba(100, 149, 237, 1)' : 'rgba(67, 97, 238, 1)';
            const demoColor = isDark ? 'rgba(186, 85, 211, 1)' : 'rgba(114, 9, 183, 1)';
            const realBg = isDark ? 'rgba(100, 149, 237, 0.1)' : 'rgba(67, 97, 238, 0.1)';
            const demoBg = isDark ? 'rgba(186, 85, 211, 0.1)' : 'rgba(114, 9, 183, 0.1)';
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)';

            profitChart.data.datasets[0].borderColor = realColor;
            profitChart.data.datasets[0].backgroundColor = realBg;
            profitChart.data.datasets[1].borderColor = demoColor;
            profitChart.data.datasets[1].backgroundColor = demoBg;
            profitChart.options.scales.y.grid.color = gridColor;

            profitChart.update();
        }

        // Call this function after creating the chart
        updateChartColors();
    </script>
</body>

</html>